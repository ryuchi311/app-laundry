{% extends "base.html" %}

{% block title %}Expense Management Dashboard - Laundry Management{% endblock %}

{% block content %}
<div class="container mx-auto px-4 sm:px-6 lg:px-8 py-8">
    <!-- Header -->
    <div class="mb-8">
        <h1 class="text-3xl font-bold text-gray-900 mb-2">Expense Management</h1>
        <p class="text-gray-600">Monitor your business expenses, revenue, and profitability</p>
    </div>

    <!-- Quick Actions -->
    <div class="mb-8">
        <div class="bg-white rounded-lg shadow-sm border border-gray-200 p-6">
            <h3 class="text-lg font-semibold text-gray-900 mb-4 flex items-center">
                <i class="fas fa-bolt text-blue-600 mr-2"></i>
                Quick Actions
                <span class="text-sm font-normal text-gray-500 ml-2">Fast access to common tasks</span>
            </h3>
            
            <div class="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-6 gap-4">
                <!-- Expense Actions -->
                <a href="{{ url_for('expenses.add_expense') }}" 
                   class="bg-blue-50 hover:bg-blue-100 border border-blue-200 text-blue-700 px-4 py-3 rounded-lg flex flex-col items-center transition-all duration-200 hover:shadow-md">
                    <i class="fas fa-plus text-2xl mb-2"></i>
                    <span class="text-sm font-medium text-center">Add Expense</span>
                </a>
                
                <a href="{{ url_for('expenses.list_expenses') }}" 
                   class="bg-green-50 hover:bg-green-100 border border-green-200 text-green-700 px-4 py-3 rounded-lg flex flex-col items-center transition-all duration-200 hover:shadow-md">
                    <i class="fas fa-list text-2xl mb-2"></i>
                    <span class="text-sm font-medium text-center">View Expenses</span>
                </a>
                
                <a href="{{ url_for('expenses.reports') }}" 
                   class="bg-purple-50 hover:bg-purple-100 border border-purple-200 text-purple-700 px-4 py-3 rounded-lg flex flex-col items-center transition-all duration-200 hover:shadow-md">
                    <i class="fas fa-chart-line text-2xl mb-2"></i>
                    <span class="text-sm font-medium text-center">Reports</span>
                </a>
                
                <!-- Laundry Actions -->
                <a href="{{ url_for('laundry.add_laundry') }}" 
                   class="bg-indigo-50 hover:bg-indigo-100 border border-indigo-200 text-indigo-700 px-4 py-3 rounded-lg flex flex-col items-center transition-all duration-200 hover:shadow-md">
                    <i class="fas fa-tshirt text-2xl mb-2"></i>
                    <span class="text-sm font-medium text-center">New Laundry</span>
                </a>
                
                <a href="{{ url_for('customer.add_customer') }}" 
                   class="bg-orange-50 hover:bg-orange-100 border border-orange-200 text-orange-700 px-4 py-3 rounded-lg flex flex-col items-center transition-all duration-200 hover:shadow-md">
                    <i class="fas fa-user-plus text-2xl mb-2"></i>
                    <span class="text-sm font-medium text-center">Add Customer</span>
                </a>
                
                <a href="{{ url_for('inventory.dashboard') }}" 
                   class="bg-teal-50 hover:bg-teal-100 border border-teal-200 text-teal-700 px-4 py-3 rounded-lg flex flex-col items-center transition-all duration-200 hover:shadow-md">
                    <i class="fas fa-boxes text-2xl mb-2"></i>
                    <span class="text-sm font-medium text-center">Inventory</span>
                </a>
            </div>
            
            <!-- Secondary Actions Row -->
            <div class="mt-4 pt-4 border-t border-gray-200">
                <div class="flex flex-wrap gap-3 justify-center">
                    <a href="{{ url_for('expenses.list_categories') }}" 
                       class="text-gray-600 hover:text-gray-800 text-sm flex items-center transition-colors duration-200">
                        <i class="fas fa-tags mr-1"></i>
                        Manage Categories
                    </a>
                    <a href="{{ url_for('laundry.list_laundries') }}" 
                       class="text-gray-600 hover:text-gray-800 text-sm flex items-center transition-colors duration-200">
                        <i class="fas fa-list mr-1"></i>
                        Laundry List
                    </a>
                    <a href="{{ url_for('customer.list_customers') }}" 
                       class="text-gray-600 hover:text-gray-800 text-sm flex items-center transition-colors duration-200">
                        <i class="fas fa-users mr-1"></i>
                        Customer List
                    </a>
                    <a href="{{ url_for('service.list_services') }}" 
                       class="text-gray-600 hover:text-gray-800 text-sm flex items-center transition-colors duration-200">
                        <i class="fas fa-cogs mr-1"></i>
                        Services
                    </a>
                </div>
            </div>
        </div>
    </div>

    <!-- Key Metrics -->
    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8">
        <!-- Monthly Revenue -->
        <div class="bg-white rounded-xl shadow-lg p-6 hover:shadow-xl transition-shadow">
            <div class="flex items-center justify-between">
                <div>
                    <div class="text-3xl font-bold text-emerald-700">₱{{ "{:,.2f}".format(monthly_revenue) }}</div>
                    <p class="text-sm text-gray-600">Monthly Revenue</p>
                </div>
                <div class="text-emerald-600">
                    <i class="fas fa-chart-line text-3xl"></i>
                </div>
            </div>
        </div>

        <!-- Monthly Expenses -->
        <div class="bg-white rounded-xl shadow-lg p-6 hover:shadow-xl transition-shadow">
            <div class="flex items-center justify-between">
                <div>
                    <div class="text-3xl font-bold text-red-700">₱{{ "{:,.2f}".format(monthly_expenses) }}</div>
                    <p class="text-sm text-gray-600">Monthly Expenses</p>
                </div>
                <div class="text-red-600">
                    <i class="fas fa-receipt text-3xl"></i>
                </div>
            </div>
        </div>

        <!-- Net Profit -->
        <div class="bg-white rounded-xl shadow-lg p-6 hover:shadow-xl transition-shadow">
            <div class="flex items-center justify-between">
                <div>
                    <div class="text-3xl font-bold {% if net_profit >= 0 %}text-emerald-700{% else %}text-red-700{% endif %}">
                        ₱{{ "{:,.2f}".format(net_profit) }}
                    </div>
                    <p class="text-sm text-gray-600">Net Profit</p>
                </div>
                <div class="{% if net_profit >= 0 %}text-emerald-600{% else %}text-red-600{% endif %}">
                    <i class="fas {% if net_profit >= 0 %}fa-arrow-trend-up{% else %}fa-arrow-trend-down{% endif %} text-3xl"></i>
                </div>
            </div>
        </div>

        <!-- Profit Margin -->
        <div class="bg-white rounded-xl shadow-lg p-6 hover:shadow-xl transition-shadow">
            <div class="flex items-center justify-between">
                <div>
                    {% set margin = ((net_profit / monthly_revenue) * 100) if monthly_revenue > 0 else 0 %}
                    <div class="text-3xl font-bold {% if margin >= 0 %}text-blue-700{% else %}text-red-700{% endif %}">
                        {{ "%.1f"|format(margin) }}%
                    </div>
                    <p class="text-sm text-gray-600">Profit Margin</p>
                </div>
                <div class="{% if margin >= 0 %}text-blue-600{% else %}text-red-600{% endif %}">
                    <i class="fas fa-percentage text-3xl"></i>
                </div>
            </div>
        </div>
    </div>

    <!-- Content Grid -->
    <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
        <!-- Recent Expenses -->
        <div class="bg-white rounded-xl shadow-lg">
            <div class="p-6 border-b border-gray-200">
                <div class="flex items-center justify-between">
                    <h2 class="text-xl font-bold text-gray-800">
                        <i class="fas fa-clock mr-2 text-blue-600"></i>
                        Recent Expenses
                    </h2>
                    <a href="{{ url_for('expenses.list_expenses') }}" class="text-blue-600 hover:text-blue-800 text-sm font-medium">
                        View All
                    </a>
                </div>
            </div>
            <div class="p-6">
                {% if recent_expenses %}
                    <div class="space-y-4">
                        {% for expense in recent_expenses[:5] %}
                        <div class="flex items-center justify-between p-4 bg-gray-50 rounded-lg" style="--expense-color: {{ expense.category.color }}">
                            <div class="flex-1">
                                <div class="flex items-center">
                                    <div class="w-3 h-3 rounded-full mr-3" style="background-color: var(--expense-color)"></div>
                                    <span class="font-medium text-gray-900">{{ expense.title }}</span>
                                </div>
                                <div class="mt-1 text-sm text-gray-600">
                                    {{ expense.category.name }} • {{ expense.expense_date.strftime('%m/%d/%Y') }}
                                    {% if expense.vendor %}• {{ expense.vendor }}{% endif %}
                                </div>
                            </div>
                            <div class="text-right">
                                <div class="text-lg font-bold text-red-600">₱{{ "{:,.2f}".format(expense.amount) }}</div>
                                <div class="text-xs text-gray-500">{{ expense.payment_status }}</div>
                            </div>
                        </div>
                        {% endfor %}
                    </div>
                {% else %}
                    <div class="text-center py-8">
                        <i class="fas fa-receipt text-gray-400 text-4xl mb-4"></i>
                        <p class="text-gray-600">No expenses recorded yet</p>
                        <a href="{{ url_for('expenses.add_expense') }}" 
                           class="text-blue-600 hover:text-blue-700 font-medium">Add your first expense</a>
                    </div>
                {% endif %}
            </div>
        </div>

        <!-- Expense by Category -->
        <div class="bg-white rounded-xl shadow-lg">
            <div class="p-6 border-b border-gray-200">
                <h2 class="text-xl font-bold text-gray-800">
                    <i class="fas fa-chart-pie mr-2 text-purple-600"></i>
                    Expenses by Category (This Month)
                </h2>
            </div>
            <div class="p-6">
                {% if category_expenses %}
                    <div class="space-y-4">
                        {% for category in category_expenses %}
                        <div class="flex items-center justify-between" style="--category-color: {{ category.color }}">
                            <div class="flex items-center">
                                <div class="w-4 h-4 rounded-full mr-3" style="background-color: var(--category-color)"></div>
                                <span class="text-gray-900 font-medium">{{ category.name }}</span>
                            </div>
                            <div class="text-right">
                                <div class="font-bold text-gray-900">₱{{ "{:,.2f}".format(category.total) }}</div>
                                {% set percentage = (category.total / monthly_expenses * 100) if monthly_expenses > 0 else 0 %}
                                <div class="text-sm text-gray-500">{{ "%.1f"|format(percentage) }}%</div>
                            </div>
                        </div>
                        {% endfor %}
                    </div>
                {% else %}
                    <div class="text-center py-8">
                        <i class="fas fa-chart-pie text-gray-400 text-4xl mb-4"></i>
                        <p class="text-gray-600">No expense categories found</p>
                    </div>
                {% endif %}
            </div>
        </div>
    </div>

    <!-- Upcoming Bills -->
    {% if upcoming_expenses %}
    <div class="mt-8">
        <div class="bg-amber-50 border border-amber-200 rounded-xl">
            <div class="p-6 border-b border-amber-200">
                <h2 class="text-xl font-bold text-amber-800">
                    <i class="fas fa-bell mr-2"></i>
                    Upcoming Bills (Next 7 Days)
                </h2>
            </div>
            <div class="p-6">
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
                    {% for expense in upcoming_expenses %}
                    <div class="bg-white rounded-lg border border-amber-200 p-4">
                        <h4 class="font-medium text-gray-900">{{ expense.title }}</h4>
                        <p class="text-sm text-gray-600">{{ expense.category.name }}</p>
                        <div class="mt-2 flex justify-between items-center">
                            <span class="text-amber-600 font-semibold">₱{{ "{:,.2f}".format(expense.amount) }}</span>
                            <span class="text-xs text-gray-500">Due: {{ expense.next_due_date.strftime('%m/%d/%Y') }}</span>
                        </div>
                    </div>
                    {% endfor %}
                </div>
            </div>
        </div>
    </div>
    {% endif %}
</div>
{% endblock %}
